{"version":3,"file":"MasterDetail.lazy-CoJDtCvv.js","sources":["../../website/routes/MasterDetail.lazy.tsx"],"sourcesContent":["import { useMemo, useRef, useState } from 'react';\nimport { faker } from '@faker-js/faker';\nimport { createLazyFileRoute } from '@tanstack/react-router';\nimport { css } from '@linaria/core';\n\nimport DataGrid from '../../src';\nimport type { Column, DataGridHandle, RowsChangeData } from '../../src';\nimport type { Direction } from '../../src/types';\nimport { CellExpanderFormatter } from '../components';\nimport { useDirection } from '../directionContext';\n\nexport const Route = createLazyFileRoute('/MasterDetail')({\n  component: MasterDetail\n});\n\ntype DepartmentRow =\n  | {\n      type: 'MASTER';\n      id: number;\n      department: string;\n      expanded: boolean;\n    }\n  | {\n      type: 'DETAIL';\n      id: number;\n      parentId: number;\n    };\n\ninterface ProductRow {\n  id: number;\n  product: string;\n  description: string;\n  price: string;\n}\n\nfunction createDepartments(): readonly DepartmentRow[] {\n  const departments: DepartmentRow[] = [];\n  for (let i = 1; i < 30; i++) {\n    departments.push({\n      type: 'MASTER',\n      id: i,\n      department: faker.commerce.department(),\n      expanded: false\n    });\n  }\n  return departments;\n}\n\nconst productsMap = new Map<number, readonly ProductRow[]>();\n\nfunction getProducts(parentId: number): readonly ProductRow[] {\n  if (productsMap.has(parentId)) return productsMap.get(parentId)!;\n  const products: ProductRow[] = [];\n  for (let i = 0; i < 20; i++) {\n    products.push({\n      id: i,\n      product: faker.commerce.productName(),\n      description: faker.commerce.productDescription(),\n      price: faker.commerce.price()\n    });\n  }\n  productsMap.set(parentId, products);\n  return products;\n}\n\nconst productColumns: readonly Column<ProductRow>[] = [\n  { key: 'id', name: 'ID', width: 35 },\n  { key: 'product', name: 'Product' },\n  { key: 'description', name: 'Description' },\n  { key: 'price', name: 'Price' }\n];\n\nfunction MasterDetail() {\n  const direction = useDirection();\n\n  const columns = useMemo((): readonly Column<DepartmentRow>[] => {\n    return [\n      {\n        key: 'expanded',\n        name: '',\n        minWidth: 30,\n        width: 30,\n        colSpan(args) {\n          return args.type === 'ROW' && args.row.type === 'DETAIL' ? 3 : undefined;\n        },\n        cellClass(row) {\n          return row.type === 'DETAIL'\n            ? css`\n                padding: 24px;\n              `\n            : undefined;\n        },\n        renderCell({ row, tabIndex, onRowChange }) {\n          if (row.type === 'DETAIL') {\n            return <ProductGrid parentId={row.parentId} direction={direction} />;\n          }\n\n          return (\n            <CellExpanderFormatter\n              expanded={row.expanded}\n              tabIndex={tabIndex}\n              onCellExpand={() => {\n                onRowChange({ ...row, expanded: !row.expanded });\n              }}\n            />\n          );\n        }\n      },\n      { key: 'id', name: 'ID', width: 35 },\n      { key: 'department', name: 'Department' }\n    ];\n  }, [direction]);\n  const [rows, setRows] = useState(createDepartments);\n\n  function onRowsChange(rows: DepartmentRow[], { indexes }: RowsChangeData<DepartmentRow>) {\n    const row = rows[indexes[0]];\n    if (row.type === 'MASTER') {\n      if (row.expanded) {\n        rows.splice(indexes[0] + 1, 0, {\n          type: 'DETAIL',\n          id: row.id + 100,\n          parentId: row.id\n        });\n      } else {\n        rows.splice(indexes[0] + 1, 1);\n      }\n      setRows(rows);\n    }\n  }\n\n  return (\n    <DataGrid\n      rowKeyGetter={rowKeyGetter}\n      columns={columns}\n      rows={rows}\n      onRowsChange={onRowsChange}\n      headerRowHeight={45}\n      rowHeight={(row) => (row.type === 'DETAIL' ? 300 : 45)}\n      className=\"fill-grid\"\n      enableVirtualization={false}\n      direction={direction}\n      onCellKeyDown={(_, event) => {\n        if (event.isDefaultPrevented()) {\n          // skip parent grid keyboard navigation if nested grid handled it\n          event.preventGridDefault();\n        }\n      }}\n    />\n  );\n}\n\nfunction ProductGrid({ parentId, direction }: { parentId: number; direction: Direction }) {\n  const gridRef = useRef<DataGridHandle>(null);\n  const products = getProducts(parentId);\n\n  return (\n    <DataGrid\n      ref={gridRef}\n      rows={products}\n      columns={productColumns}\n      rowKeyGetter={rowKeyGetter}\n      style={{ blockSize: 250 }}\n      direction={direction}\n    />\n  );\n}\n\nfunction rowKeyGetter(row: DepartmentRow | ProductRow) {\n  return row.id;\n}\n"],"names":["Route","createLazyFileRoute","component","MasterDetail","createDepartments","departments","i","push","type","id","department","faker","commerce","expanded","productsMap","Map","getProducts","parentId","has","get","products","product","productName","description","productDescription","price","set","productColumns","key","name","width","direction","useDirection","columns","useMemo","minWidth","colSpan","args","row","cellClass","renderCell","tabIndex","onRowChange","jsx","ProductGrid","CellExpanderFormatter","onCellExpand","rows","setRows","useState","onRowsChange","indexes","splice","DataGrid","rowKeyGetter","headerRowHeight","rowHeight","className","enableVirtualization","onCellKeyDown","_","event","isDefaultPrevented","preventGridDefault","gridRef","useRef","ref","style","blockSize"],"mappings":"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"}